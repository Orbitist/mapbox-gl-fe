<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <title></title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <!-- Mapbox JS and CSS -->
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.css' rel='stylesheet' />

  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <!-- Lightbox -->
  <script src="plugins/lightbox/js/lightbox.min.js"></script>
  <link href="plugins/lightbox/css/lightbox.css" rel="stylesheet" />

  <!-- Twitter Widjet Script -->
  <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

  <!-- Instagram Widjet Script -->
  <script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

  <!-- Orbitist Styles -->
  <link href='css/orbitist.css' rel='stylesheet' />
</head>
<body>

  <!-- Spinner -->
  <div class="spinner">
    <div class="sk-spinner sk-spinner-pulse"></div>
  </div>

  <!-- Map -->
  <div id='map'></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoib3JiaXRpc3QiLCJhIjoiYnpUTnJBdyJ9.uxgaJ0R9ZNsCcEnPNfo2ag';

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v9'
    });

    var orbitistPointsGeojson = "https://app.orbitist.com/api/v1/points/90.json";

    map.on('load', function() {
      map.addSource("orbitistPoints", {
        type: "geojson",
        data: orbitistPointsGeojson
      });
      map.addLayer({
        "id": "points",
        "type": "symbol",
        "source": "orbitistPoints",
        "layout": {
          "icon-image": "airfield-11",
          "icon-allow-overlap": true,
          "text-field": "{point_title}",
          "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
          "text-offset": [0, 0.5],
          "text-anchor": "top"
        }
      });
    });

    map.on('click', function (e) {
      var features = map.queryRenderedFeatures(e.point, { layers: ['points'] });

      if (!features.length) {
          return;
      }

      var feature = features[0];

      // Populate the popup and set its coordinates
      // based on the feature found.
      var popup = new mapboxgl.Popup()
          .setLngLat(feature.geometry.coordinates)
          .setHTML(feature.properties.point_title)
          .addTo(map);

      // Use queryRenderedFeatures to get features at a click event's point
      // Use layer option to avoid getting results from other layers
      var features = map.queryRenderedFeatures(e.point, { layers: ['points'] });
      // if there are features within the given radius of the click event,
      // fly to the location of the click event
      if (features.length) {
          // Get coordinates from the symbol and center the map on those coordinates
          map.flyTo({center: features[0].geometry.coordinates});
      }
  });

  // Use the same approach as above to indicate that the symbols are clickable
  // by changing the cursor style to 'pointer'.
  map.on('mousemove', function (e) {
      var features = map.queryRenderedFeatures(e.point, { layers: ['points'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
  });

  </script>

  <!-- spinner -->
  <script>
  $(document).ready(function() {
  	$(this).find(".spinner").delay(2000).fadeOut(500, function () {
  		$(this).remove();
  	});
  });
  </script>

</body>
</html>
